<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorldShorts</title>
    <link rel="stylesheet" href="style.css">

    <!-- Firebase SDKs from Official CDN -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        console.log("Starting Firebase setup");

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCIZ74FPVXps5XfCldIb42-UBuTbQhOJV0",
            authDomain: "world-shorts.firebaseapp.com",
            projectId: "world-shorts",
            storageBucket: "world-shorts.appspot.com",
            messagingSenderId: "299276936060",
            appId: "1:299276936060:web:b33d605263f7f5b5d37af9",
            measurementId: "G-XZFKCVMPV7"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();

        console.log("Firebase Initialized:", firebase.apps);
    </script>
</head>
<body>
    <h1>Welcome to WorldShorts</h1>
    <div id="app">
        <!-- Registration Form -->
        <h2>Register</h2>
        <form id="registerForm">
            <input type="email" id="registerEmail" placeholder="Email" required>
            <input type="password" id="registerPassword" placeholder="Password" required>
            <button type="button" onclick="registerUser()">Register</button>
        </form>

        <!-- Login Form -->
        <h2>Login</h2>
        <form id="loginForm">
            <input type="email" id="loginEmail" placeholder="Email" required>
            <input type="password" id="loginPassword" placeholder="Login" required>
            <button type="button" onclick="loginUser()">Login</button>
        </form>

        <!-- Auth Status -->
        <div id="authStatus"></div>

        <!-- Video Upload Form -->
        <h2>Upload Video Short</h2>
        <form id="uploadForm">
            <input type="file" id="videoFile" accept="video/*" required>
            <button type="button" onclick="uploadVideo()">Upload Video</button>
        </form>
        <div id="uploadStatus"></div>
    </div>

    <script>
        // Reference to Firebase Authentication and Firestore
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Register a new user
        function registerUser() {
            const email = document.getElementById("registerEmail").value;
            const password = document.getElementById("registerPassword").value;

            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Successfully registered
                    const user = userCredential.user;
                    document.getElementById("authStatus").innerText = `Registered successfully with UID: ${user.uid}`;
                    console.log("User registered:", user);
                })
                .catch((error) => {
                    // Handle errors here
                    console.error("Error during registration:", error);
                    document.getElementById("authStatus").innerText = `Registration error: ${error.message}`;
                });
        }

        // Login an existing user
        function loginUser() {
            const email = document.getElementById("loginEmail").value;
            const password = document.getElementById("loginPassword").value;

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Successfully logged in
                    const user = userCredential.user;
                    document.getElementById("authStatus").innerText = `Logged in successfully with UID: ${user.uid}`;
                    console.log("User logged in:", user);
                })
                .catch((error) => {
                    // Handle errors here
                    console.error("Error during login:", error);
                    document.getElementById("authStatus").innerText = `Login error: ${error.message}`;
                });
        }

        // Upload video metadata only (no actual video upload)
        function uploadVideo() {
            const file = document.getElementById("videoFile").files[0];
            if (!file) {
                document.getElementById("uploadStatus").innerText = "Please select a video file.";
                return;
            }

            // Get file details and metadata
            const userId = firebase.auth().currentUser.uid;
            const metadata = {
                name: file.name,
                size: file.size,
                type: file.type,
                userId: userId,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };

            // Save metadata to Firestore
            db.collection("videos").add(metadata)
                .then(() => {
                    document.getElementById("uploadStatus").innerText = "Video metadata saved successfully!";
                    console.log("Video metadata saved:", metadata);
                })
                .catch((error) => {
                    console.error("Error saving metadata to Firestore:", error);
                    document.getElementById("uploadStatus").innerText = `Error saving metadata: ${error.message}`;
                });
        }
    </script>
</body>
</html>
